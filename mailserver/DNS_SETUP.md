# DNS Configuration for nameinahat.com Mail Server

This guide shows the DNS records needed for proper mail server operation with nameinahat.com.

## Required DNS Records

### 1. MX Record (Mail Exchange)
```
Type: MX
Name: @
Value: mail.nameinahat.com
Priority: 10
TTL: 3600
```

### 2. A Record for Mail Server
```
Type: A  
Name: mail
Value: 172.233.171.101
TTL: 3600
```

### 3. SPF Record (Sender Policy Framework)
```
Type: TXT
Name: @
Value: v=spf1 mx a:mail.nameinahat.com ip4:172.233.171.101 ~all
TTL: 3600
```

### 4. DKIM Record (DomainKeys Identified Mail)
**Note**: The DKIM public key will be generated by the setup script. Use the output from setup-mailserver.sh:

```
Type: TXT
Name: mail._domainkey
Value: v=DKIM1; h=sha256; k=rsa; p=[PUBLIC_KEY_FROM_SETUP_SCRIPT]
TTL: 3600
```

### 5. DMARC Record (Domain-based Message Authentication)
```
Type: TXT
Name: _dmarc
Value: v=DMARC1; p=quarantine; rua=mailto:admin@nameinahat.com; ruf=mailto:admin@nameinahat.com; fo=1
TTL: 3600
```

### 6. Reverse DNS (PTR) - Optional but Recommended
**Note**: This typically requires coordination with your hosting provider (Linode).

Contact Linode support to set up reverse DNS:
- IP: 172.233.171.101
- Hostname: mail.nameinahat.com

## Security Considerations

### TLS/SSL Certificate
The mail server is configured to use manual SSL certificates. You'll need:
1. Valid SSL certificate for mail.nameinahat.com
2. Place certificate files in `ssl/` directory:
   - `ssl/fullchain.pem` - Full certificate chain
   - `ssl/privkey.pem` - Private key

### Port Configuration
The mail server uses alternative ports to avoid conflicts:
- SMTP: 2525 (instead of 25)
- Submission: 2587 (instead of 587) 
- SMTPS: 2465 (instead of 465)
- IMAP: 2143 (instead of 143)
- IMAPS: 2993 (instead of 993)

## GoDaddy DNS Configuration

If using GoDaddy for nameinahat.com DNS:

1. **Login to GoDaddy DNS Management**
2. **Navigate to DNS Records for nameinahat.com**
3. **Add the following records:**

### MX Record:
- Host: @
- Points to: mail.nameinahat.com
- Priority: 10
- TTL: 1 Hour

### A Record:
- Host: mail  
- Value: 172.233.171.101
- TTL: 1 Hour

### SPF TXT Record:
- Host: @
- TXT Value: v=spf1 mx a:mail.nameinahat.com ip4:172.233.171.101 ~all
- TTL: 1 Hour

### DKIM TXT Record:
- Host: mail._domainkey
- TXT Value: [Generated by setup script]
- TTL: 1 Hour

### DMARC TXT Record:
- Host: _dmarc
- TXT Value: v=DMARC1; p=quarantine; rua=mailto:admin@nameinahat.com; ruf=mailto:admin@nameinahat.com; fo=1
- TTL: 1 Hour

## Verification

After DNS propagation (24-48 hours), verify your setup:

### Check DNS Records:
```bash
# MX Record
dig MX nameinahat.com

# SPF Record  
dig TXT nameinahat.com

# DKIM Record
dig TXT mail._domainkey.nameinahat.com

# DMARC Record
dig TXT _dmarc.nameinahat.com
```

### Mail Server Test Tools:
- https://mxtoolbox.com/domain/nameinahat.com
- https://www.mail-tester.com/
- https://dmarcanalyzer.com/

## Troubleshooting

### Common Issues:
1. **Mail not delivered**: Check SPF/DKIM records
2. **Marked as spam**: Verify DMARC policy and reverse DNS
3. **Connection refused**: Verify firewall and port configuration
4. **SSL errors**: Check certificate validity and paths

### Debug Commands:
```bash
# Check mail server logs
docker-compose logs nameinahat-mail

# Test SMTP connection
telnet 172.233.171.101 2587

# Verify DKIM signing
echo "Test message" | mail -s "Test" test@example.com
```